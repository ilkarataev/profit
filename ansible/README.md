# Ansible Configuration

Ansible –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
ansible/
‚îú‚îÄ‚îÄ playbook-server.yml           # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (Docker, Traefik, Portainer)
‚îú‚îÄ‚îÄ deploy-universal.yml          # –î–µ–ø–ª–æ–π —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ ssh_key.yml                   # SSH –∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
‚îú‚îÄ‚îÄ run-setup.sh                  # –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ run-universal-deploy.sh       # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ templates/
    ‚îú‚îÄ‚îÄ env-universal.j2          # –®–∞–±–ª–æ–Ω .env —Ñ–∞–π–ª–∞
    ‚îî‚îÄ‚îÄ docker-compose-universal.j2 # –®–∞–±–ª–æ–Ω docker-compose.yml
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
```bash
cd ansible
./run-setup.sh "your-domain.com"
```

### –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
cd ansible
./run-universal-deploy.sh "your-domain.com" "client1"
```

## üìã Playbooks

### `playbook-server.yml`
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è appuser
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–µ–π
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Traefik (reverse proxy)
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Portainer (Docker UI)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Fail2ban
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Portainer

### `deploy-universal.yml`
–î–µ–ø–ª–æ–π —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–π –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `site_domain` - –¥–æ–º–µ–Ω –¥–ª—è –¥–µ–ø–ª–æ—è
- `client_name` - –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: main)

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- `hh_client_id` - ID –∫–ª–∏–µ–Ω—Ç–∞ HH API
- `hh_client_secret` - Secret –∫–ª–∏–µ–Ω—Ç–∞ HH API
- `webhook_url_avito` - Webhook URL –¥–ª—è Avito
- `webhook_url_hh` - Webhook URL –¥–ª—è HH
- `sentry_dsn` - Sentry DSN –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üê≥ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

–ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
- `avito-{client_name}` - Avito API —Å–µ—Ä–≤–∏—Å
- `hh-{client_name}` - HH API —Å–µ—Ä–≤–∏—Å
- `redis-{client_name}` - Redis –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- SSH –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π
- –ò–∑–æ–ª—è—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç Let's Encrypt

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker logs avito-client1
docker logs hh-client1
docker logs redis-client1
```

### Portainer:
- URL: `https://your-domain.com/portainer/`
- –õ–æ–≥–∏–Ω: `admin`
- –ü–∞—Ä–æ–ª—å: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### Traefik Dashboard:
- URL: `https://your-domain.com/traefik/`
- –õ–æ–≥–∏–Ω: `admin`
- –ü–∞—Ä–æ–ª—å: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```bash
cd ansible
./run-universal-deploy.sh "your-domain.com" "client1"
```

Playbook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –û–±–Ω–æ–≤–ª—è–µ—Ç –æ–±—Ä–∞–∑—ã
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ volumes
