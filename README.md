# üöÄ Automated Server Setup and Application Deployment

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Ansible –∏ GitHub Actions.

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞** - Docker, Traefik, Portainer, SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- **Path-based routing** - `domain.com/portainer/`, `domain.com/traefik/`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ SSL** - Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- **GitHub Actions** - –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - Fail2ban, SSH –∫–ª—é—á–∏, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Action

### 1. –°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á —Å–µ–∫—Ä–µ—Ç –≤ GitHub

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí Secrets and variables ‚Üí Actions** –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```
SSH_PRIVATE_KEY=-----BEGIN OPENSSH PRIVATE KEY-----
–≤–∞—à_–ø—Ä–∏–≤–∞—Ç–Ω—ã–π_–∫–ª—é—á_–∑–¥–µ—Å—å
-----END OPENSSH PRIVATE KEY-----
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞:
```
A    app.scarion.su    46.62.213.224
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ GitHub Actions

**–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Actions** –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. –í—ã–±–µ—Ä–∏—Ç–µ **Setup Server**
3. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
   - **Domain**: `app.scarion.su`
   - **Server IP**: `46.62.213.224`

**–ó–∞—Ç–µ–º —Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
1. –í—ã–±–µ—Ä–∏—Ç–µ **Deploy Application**
2. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
   - **Domain**: `app.scarion.su`
   - **Server IP**: `46.62.213.224`
   - **Action**: `deploy`

## üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ GitHub Actions

### 1. Setup Server
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker, Docker Compose
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Traefik —Å SSL
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Portainer
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fail2ban
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `appuser`

### 2. Deploy Application
- **Deploy** - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  - –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
  - –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- **Update** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
  - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

## üåê URL-–∞–¥—Ä–µ—Å–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- **–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç**: `https://app.scarion.su/`
- **Portainer**: `https://app.scarion.su/portainer/`
- **Traefik Dashboard**: `https://app.scarion.su/traefik/`

## üîë –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø–∞—Ä–æ–ª–∏ –±—É–¥—É—Ç –≤—ã–≤–µ–¥–µ–Ω—ã –≤ –ª–æ–≥–∞—Ö GitHub Action:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `admin`
- **–ü–∞—Ä–æ–ª—å**: (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ .github/workflows/deploy.yml    # GitHub Action
‚îú‚îÄ‚îÄ ansible/
‚îÇ   ‚îú‚îÄ‚îÄ playbook-server.yml         # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ deploy-app.yml              # –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ common-setup.yml            # –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ run-setup.sh               # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
‚îú‚îÄ‚îÄ docker-compose-production.yml   # Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ README.md
```

## üöÄ –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é:

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
./ansible/run-setup.sh "app.scarion.su" "46.62.213.224"

# –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
./ansible/run-deploy.sh "app.scarion.su" "46.62.213.224"
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- SSH –∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
- Fail2ban –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Docker —Å–µ—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ GitHub Action
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SSH –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–µ–∫—Ä–µ—Ç—ã
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ —É–∫–∞–∑–∞–Ω –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö